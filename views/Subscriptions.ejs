
<%- include('partials/head.ejs') %>

<body>

  <style>
    .parentContainerOfAllchild {
      min-height: 100%;
      background: white;
    }

    .buttonsSection {
      justify-content: space-between;
      display: flex;
      flex-direction: row-reverse;
    }

    .buttonsSection a:hover {
      color: white;
    }

    .buttonsSection a {
      text-decoration: none;
    }

    .buttonsSection a {
      background-color: #ffffff;
    }

    .table td {
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal;
      word-wrap: break-word;
    }
  </style>

  <div class="container-scroller">
    <%- include('partials/navbar.ejs') %>
    <div class="container-fluid page-body-wrapper">
      <%- include('partials/sidebar.ejs') %>
      <div class="main-panel">
        <div class="content-wrapper">
          <div class="page-header">
            <h3 class="page-title">
              <span class="page-title-icon bg-gradient-primary text-white me-2">
                <i class="mdi mdi-home"></i>
              </span> subscriptions
            </h3>
          </div>

          <!-- Add Subscription Form -->
          <form action="/subscriptions" method="POST">
            <input type="text" name="name" placeholder="Name" required />
            <input type="text" name="description" placeholder="Description" required />
            <input type="number" name="price" placeholder="Price" required />
            <input type="text" name="duration" placeholder="Duration" required />
            <button type="button" onclick="openSubscriptionModal()">Add Subscription</button>
          </form>


          <div class="row" style="margin-top: 6px;">
            <div class="col-lg-12 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">

                  <h1></h1>

                  <!-- Modal -->
                  <div id="subscriptionModal" class="modal">
                    <div class="modal-content">
                      <span class="close" onclick="closeSubscriptionModal()">&times;</span>
                      <h2>Add/Edit Subscription</h2>
                      <form id="subscriptionForm" action="/subscriptions" method="POST">
                        <input type="hidden" name="_method" id="methodField" value="POST">
                        <input type="hidden" name="subscriptionId" id="subscriptionId">
                        <input type="text" name="name" id="subscriptionName" placeholder="Name" required>
                        <input type="text" name="description" id="subscriptionDescription" placeholder="Description" required>
                        <input type="number" name="price" id="subscriptionPrice" placeholder="Price" required>
                        <input type="text" name="duration" id="subscriptionDuration" placeholder="Duration" required>
                        <button type="submit" id="subscriptionButton">Add Subscription</button>
                      </form>
                    </div>
                  </div>

                  <input type="search" style="float: right;" onkeyup="searchHere()" id="searchInput" name="q"
                    placeholder="Search...." aria-label="Search">
                  <div class="containPaginationINfo"></div>

                  <table class="table">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Price</th>
                        <th>Duration</th>
                        <th>Action</th>
                      </tr>
                    </thead>

                    <tbody>
                      <% subscriptions.forEach(subscription => { %>
                      <tr>
                        <td><%= subscription.name %></td>
                        <td><%= subscription.description %></td>
                        <td><%= subscription.price %></td>
                        <td><%= subscription.duration %></td>
                        <td style="width: 92px;">
                          <a href="#" onclick="editSubscriptionModal('<%= subscription._id %>', '<%= subscription.name %>', '<%= subscription.description %>', '<%= subscription.price %>', '<%= subscription.duration %>')" style="text-decoration: none; color: rgb(15, 0, 0); background-color: #ffffff; padding: 5px; border-radius: 3px;">
                            <i class="fa fa-edit" aria-hidden="true"></i>
                          </a>
                          <a href="#" onclick="deleteSubscription('<%= subscription._id %>')" style="text-decoration: none; color: rgb(15, 0, 0); background-color: #ffffff; padding: 5px; border-radius: 3px;">
                            <i class="fa fa-trash" aria-hidden="true"></i>
                          </a>
                        </td>
                      </tr>
                      <% }) %>
                    </tbody>
                  </table>

                </div>
              </div>
            </div>
          </div>
        </div>
        <%- include('partials/footer.ejs') %>
      </div>
    </div>
  </div>

  <script>
    // Open the modal for adding a new subscription
    function openSubscriptionModal() {
      document.getElementById('methodField').value = 'POST';
      document.getElementById('subscriptionButton').innerText = 'Add Subscription';
      document.getElementById('subscriptionId').value = '';
      document.getElementById('subscriptionName').value = '';
      document.getElementById('subscriptionDescription').value = '';
      document.getElementById('subscriptionPrice').value = '';
      document.getElementById('subscriptionDuration').value = '';
      document.getElementById('subscriptionModal').style.display = 'block';
    }

    // Open the modal for editing an existing subscription
    function editSubscriptionModal(id, name, description, price, duration) {
      document.getElementById('methodField').value = 'PUT';
      document.getElementById('subscriptionButton').innerText = 'Update Subscription';
      document.getElementById('subscriptionId').value = id;
      document.getElementById('subscriptionName').value = name;
      document.getElementById('subscriptionDescription').value = description;
      document.getElementById('subscriptionPrice').value = price;
      document.getElementById('subscriptionDuration').value = duration;
      document.getElementById('subscriptionModal').style.display = 'block';
    }

    // Close the modal
    function closeSubscriptionModal() {
      document.getElementById('subscriptionModal').style.display = 'none';
    }

    function deleteSubscription(subscriptionId) {
      if (confirm("Are you sure you want to delete this subscription?")) {
        fetch(`/subscriptions/${subscriptionId}`, { method: "DELETE" })
          .then((response) => {
            if (response.ok) {
              // Subscription deleted successfully, remove from UI
              document.getElementById(`deleteForm-${subscriptionId}`).parentNode.remove();
            } else {
              // Handle error
              console.error("Failed to delete subscription");
            }
          })
          .catch((error) => {
            console.error("Error deleting subscription:", error);
          });
      }
    }

    function searchHere() {
      var input, filter, table, tr, td, i;
      input = document

.getElementById("searchInput");


 filter = input.value.toUpperCase();
      table = document.querySelector(".table");
      tr = table.getElementsByTagName("tr");
      for (i = 0; i < tr.length; i++) {
        var found = false;
        for (var j = 0; j < tr[i].cells.length; j++) {
          td = tr[i].cells[j];
          if (td) {
            if (td.innerHTML.toUpperCase().indexOf(filter) > -1) {
              found = true;
            }
          }
        }
        if (found) {
          tr[i].style.display = "";
        } else {
          tr[i].style.display = "none";
        }
      }
    }

    document.getElementById("searchInput").addEventListener("keyup", searchHere);
  </script>

  <%- include('partials/scripts.ejs') %>

</body>

</html>
