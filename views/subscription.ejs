<%- include('partials/head.ejs') %>
<body>
  <style>
    .parentContainerOfAllchild {
      min-height: 100%;
      background: white;
    }

    .buttonsSection {
      justify-content: space-between;
      display: flex;
      flex-direction: row-reverse;
    }

    .buttonsSection a:hover {
      color: white;
    }

    .buttonsSection a {
      text-decoration: none;
    }

    .buttonsSection a {
      background-color: #ffffff;
    }

    .table td {
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: normal;
      word-wrap: break-word;
    }
    .parentContainerOfAllchild {
        min-height: 100%;
        background: white;
      }

      .buttonsSection {
        /* padding: 15px; */
        justify-content: space-between;
        display: flex;
        flex-direction: row-reverse;
      }

      .buttonsSection a:hover {
        color: white;
      }

      .buttonsSection a {
        text-decoration: none;
      }

      .buttonsSection a {
        background-color: #ffffff;
      }

      .table td {
                       max-width: 200px;
                       white-space: nowrap;
                       overflow: hidden;
                       text-overflow: ellipsis;
                       white-space: normal;
                       word-wrap: break-word;
                   }
#UniqueDesignForModal{
  width: 50%;
  margin: auto;
  margin-top: 17%;
  background: white;
}

  .modal {
                    display: none;
                    position: fixed;
                    z-index: 1;
                    left: 0;
                    top: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(255, 255, 255, 0.4);
                  }

                  .modal-content {
                    background-color: #fff;
                    margin: 22% auto;
                    padding: 20px;
                    border: 1px solid #888;
                    width: 45%;
                    box-shadow: 0 4px 8px 0 rgba(255, 255, 255, 0.2);
                    padding: 44px;
                    padding-top: 25px;
                  }

                  .close {
                    color: #aaa;
                    float: right;
                    font-size: 28px;
                    font-weight: bold;
                    cursor: pointer;
                    display: flex;
                    flex-direction: row-reverse;
                  }

                  .close:hover {
                    color: rgb(255, 255, 255);
                  }

                    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .pagination button {
      margin: 0 5px;
      padding: 5px 10px;
      border-radius: 5px;
      background-color: #11550b;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    .pagination button:hover {
      background-color: #30a76b;
    }

    /* Add styles for search input */
    .search-container {
      margin-bottom: 10px;
    }

    .search-container input[type=text] {
      padding: 5px;
      margin-right: 5px;
      width: 200px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .search-container button {
      padding: 5px 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .search-container button:hover {
      background-color: #45a049;
    }
        .search-container {
      margin-bottom: 10px;
    }

    .search-container input[type=text] {
      padding: 5px;
      margin-right: 5px;
      width: 200px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .search-container button {
      padding: 5px 10px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .search-container button:hover {
      background-color: #45a049;
    }
    #searchInput {
    padding: 57px -34px 9px 86px;
    width: 294px;
    border: 1px solid rgb(255, 255, 255);
    border-radius: 5px;
}
.search-container input[type=text] {
    padding: 5px;
    margin-right: 5px;
    width: 303px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
}
  </style>
  <div class="container-scroller">
    <%- include('partials/navbar.ejs') %>
    <div class="container-fluid page-body-wrapper">
      <%- include('partials/sidebar.ejs') %>
      <div class="main-panel">
        <div class="content-wrapper">
          <div class="page-header">
            <h3 class="page-title">
              <span class="page-title-icon bg-gradient-primary text-white me-2">
                <i class="mdi mdi-home"></i>
              </span> Subscription
          </div>

<a href="#" class="button-12" id="openModalBtn" style="display: flex; align-items: center;" onclick="openModal()">
  <span style="margin-left: -18px; color: rgb(255, 255, 255);margin-left: -18px;
    color: #ffffff;">Create</span>
  <i class="fa-solid fa-plus" style="margin-left: 56px; margin-top: -17px; color:black;"></i>
</a>

<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Enter Subscription Information</h2>
    <form id="subscriptionForm">
      <label for="subscriptionName">Subscription Name:</label>
      <input type="text" id="subscriptionName" name="name" required><br><br>
      <label for="description">Description:</label>
      <textarea id="description" name="description" rows="4" cols="50" required></textarea><br><br>
      <label for="price">Price:</label>
      <input type="number" id="price" name="price" required><br><br>
      <label for="duration">Duration:</label>
      <input type="text" id="duration" name="duration" required><br><br>
      <button type="submit">Submit</button>
    </form>
  </div>
</div>
          <div class="row" style="margin-top: 6px;">
            <div class="col-lg-12 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <!-- <a href="/detaildcampaignHistory">Click here</a> -->
                  <h1></h1>


                  <div class="containPaginationINfo"></div>

                  <table class="table" id="campaignsTable">
                            <!-- Add search container -->
        <div class="search-container">
          <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Search for Subscription names..">
        </div>
                    <thead>
                      <tr>
                        <th>Subscription Name</th>
                        <th>Description</th>
                        <th>Price</th>
                        <th>Duration</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% for (let i=0; i < subscriptionhistory.length; i++) { %>
                      <tr>
                        <td><%= subscriptionhistory[i].name %></td>
                        <td><%= subscriptionhistory[i].description %></td>
                        <td><%= subscriptionhistory[i].price %></td>
                        <td><%= subscriptionhistory[i].duration %></td>
<td style="width: 92px;">
  <a href="#" onclick="deleteCampaign('<%= subscriptionhistory[i]._id %>')" style="text-decoration: none; color: rgb(15, 0, 0); background-color: #ffffff; padding: 5px; border-radius: 3px;">
    <i class="fa fa-trash" aria-hidden="true"></i>
  </a>
</td>

                      </tr>

                      </td>

                      <% } %>
                    </tbody>
                  </table>



<!-- Add pagination HTML -->
<div class="pagination">
  <button onclick="prevPage()">Previous</button>
  <button onclick="nextPage()">Next</button>
</div>


                </div>
              </div>
            </div>
          </div>
          </div>
      </div>
      </div>
  </div>
</body>
  <script>

// Function to handle form submission
document.getElementById("subscriptionForm").addEventListener("submit", function(event) {
  event.preventDefault(); // Prevent default form submission

  // Get form data
  const formData = new FormData(event.target);
  console.log("here....");
console.log(formData);
  // Send subscription data to the server
  fetch('/addsubscriptions', {
    method: 'POST',
    body: formData
  })
  .then(response => {
    if (response.ok) {
      // If subscription is successfully added, close the modal and possibly update the UI
      closeModal();
      // Optionally, you can update the UI to display the newly added subscription without refreshing the page
    } else {
      throw new Error('Failed to add subscription');
    }
  })
  .catch(error => {
    console.error('Error adding subscription:', error);
    // Optionally, display an error message to the user
  });
});



  function deleteCampaign(id) {
  if (confirm("Are you sure you want to delete this campaign?")) {
    fetch(`/subscription/${id}`, {
      method: 'DELETE'
    })
    .then(response => {
      if (response.ok) {
        // Update the UI to remove the deleted campaign
        document.getElementById(id).remove();
      } else {
        throw new Error('Failed to delete campaign');
      }
    })
    .catch(error => {
      console.error('Error deleting campaign:', error);
    });
  }
}


    function openModal() {
        var modal = document.getElementById('myModal');
        modal.style.display = 'block';
        // Use the 'name' parameter here as needed
    }

    function closeModal() {
        var modal = document.getElementById('myModal');
        modal.style.display = 'none';
    }

    window.onclick = function (event) {
        var modal = document.getElementById('myModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    };



    function searchTable() {
      // Declare variables
      var input, filter, table, tr, td, i, txtValue;
      input = document.getElementById("searchInput");
      filter = input.value.toUpperCase();
      table = document.getElementById("campaignsTable");
      tr = table.getElementsByTagName("tr");

      // Loop through all table rows, and hide those that don't match the search query
      for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[0]; // Change index to match the column you want to search (0 for Campaign Name)
        if (td) {
          txtValue = td.textContent || td.innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none";
          }
        }
      }
    }


  // Define variables for pagination
  var currentPage = 1;
  var rowsPerPage = 2; // Number of rows to display per page

  function prevPage() {
    if (currentPage > 1) {
    currentPage--;
  displayRows();
    }
  }

  function nextPage() {
    var table = document.getElementById("campaignsTable");
  var totalPages = Math.ceil(table.rows.length / rowsPerPage);
  if (currentPage < totalPages) {
    currentPage++;
  displayRows();
    }
  }

  function displayRows() {
    var table = document.getElementById("campaignsTable");
  var rows = table.getElementsByTagName("tr");

  // Calculate start and end index for current page
  var startIndex = (currentPage - 1) * rowsPerPage;
  var endIndex = startIndex + rowsPerPage;

  // Loop through all rows and display or hide based on current page
  for (var i = 0; i < rows.length; i++) {
      if (i >= startIndex && i < endIndex) {
    rows[i].style.display = "";
      } else {
    rows[i].style.display = "none";
      }
    }
  }

  // Call displayRows() when the page loads
  window.onload = function() {
    displayRows();
  };


</script>
</html>
